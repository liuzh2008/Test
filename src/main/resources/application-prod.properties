# 医疗AI助手后端系统 - 生产环境配置

# ===============================
# 服务器配置
# ===============================
server.port=8081
server.servlet.context-path=/api
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
server.compression.min-response-size=1024

# ===============================
# 数据库配置 - Oracle
# ===============================
# 使用Oracle数据库配置
spring.datasource.url=jdbc:oracle:thin:@127.0.0.1:1521/FREE
spring.datasource.driver-class-name=oracle.jdbc.OracleDriver
spring.datasource.username=system
spring.datasource.password=Liuzh_123
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.idle-timeout=240000
spring.datasource.hikari.max-lifetime=300000
spring.datasource.hikari.leak-detection-threshold=120000
spring.datasource.hikari.initialization-fail-timeout=60000
spring.datasource.hikari.keepalive-time=120000
spring.datasource.hikari.validation-timeout=5000
spring.datasource.hikari.connection-test-query=SELECT 1 FROM DUAL
spring.datasource.hikari.connection-init-sql=ALTER SESSION SET NLS_DATE_FORMAT='YYYY-MM-DD HH24:MI:SS'

# ===============================
# JPA/Hibernate配置
# ===============================
spring.jpa.database-platform=org.hibernate.dialect.OracleDialect
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.generate_statistics=false

# ===============================
# 执行服务器配置
# ===============================
execution.server.ip=nb.nblink.cc
execution.server.url=http://nb.nblink.cc:16601
spring.datasource.sid=FREE
# 注意：execution.server.timeout.connect 和 execution.server.timeout.read 是自定义属性

# ===============================

# ===============================
# 异步配置
# ===============================
spring.task.execution.pool.core-size=10
spring.task.execution.pool.max-size=20
spring.task.execution.pool.queue-capacity=100
spring.task.execution.thread-name-prefix=async-
spring.task.scheduling.pool.size=5
spring.task.scheduling.thread-name-prefix=sched-

# ===============================
# 日志配置
# ===============================
logging.level.com.example.medaiassistant=INFO
logging.level.org.springframework.web=WARN
logging.level.org.hibernate=WARN
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN
logging.level.org.hibernate.engine.jdbc.spi.SqlExceptionHelper=ERROR
logging.level.org.apache=WARN
logging.file.name=/app/logs/application.log
# 使用新的日志滚动策略配置
logging.logback.rollingpolicy.max-file-size=100MB
logging.logback.rollingpolicy.max-history=30
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ===============================
# 监控和健康检查
# ===============================
management.endpoints.web.exposure.include=health,info,metrics,env
management.endpoint.health.show-details=when_authorized
management.endpoint.health.probes.enabled=true
# 使用新的Prometheus指标导出配置
management.prometheus.metrics.export.enabled=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true

# ===============================
# 缓存配置
# ===============================
spring.cache.type=redis
spring.cache.redis.time-to-live=3600000
spring.cache.redis.cache-null-values=false
# 使用新的Redis数据配置
spring.data.redis.host=redis
spring.data.redis.port=6379
spring.data.redis.password=${REDIS_PASSWORD:redispassword}
spring.data.redis.timeout=5000
# Lettuce连接池配置
spring.data.redis.lettuce.pool.max-active=20
spring.data.redis.lettuce.pool.max-idle=10
spring.data.redis.lettuce.pool.min-idle=5
spring.data.redis.lettuce.pool.max-wait=3000

# ===============================
# 定时任务配置
# ===============================
scheduling.auto-execute.interval=5000
scheduling.auto-execute.max-threads=10
scheduling.auto-execute.enabled=true
scheduling.timer.daily-time=0 0 4 * * *
scheduling.timer.surgery-analysis-time=0 0 5 * * *
scheduling.timer.noon-ward-round-time=0 0 13 * * *
scheduling.timer.max-concurrency=5
scheduling.timer.fixed-delay-minutes=5

# 患者状态更新服务 - 科室+床号过滤配置（生产环境）
# 启用科室和床位过滤，仅处理指定科室指定床位的病危/病重患者
scheduling.timer.department-filter-enabled=true
scheduling.timer.bed-filter-enabled=true

# 科室-床号映射配置（根据生产环境实际需求修改）
scheduling.timer.department-bed-numbers.心血管一病区=15,16,17,18,19,20,21,22,23,24,25,26,27,38,39,40,53,54,55,63,64,60,61
scheduling.executor.pool-size=10
scheduling.executor.thread-name-prefix=scheduled-
scheduling.executor.core-pool-size=5
scheduling.executor.max-pool-size=20
scheduling.executor.queue-capacity=100
scheduling.monitoring.enabled=true
scheduling.monitoring.metrics-interval=60
scheduling.monitoring.alert-emails=admin@example.com

# ===============================
# 执行服务器轮询配置 - 多线程优化
# ===============================
scheduling.execution-polling.max-concurrency=5
scheduling.execution-polling.timeout-seconds=900
scheduling.execution-polling.concurrent-enabled=true
scheduling.prompt-generation-pool.core-pool-size=3
scheduling.prompt-generation-pool.max-pool-size=5
scheduling.prompt-generation-pool.queue-capacity=50
scheduling.prompt-generation-pool.thread-name-prefix=medai-prompt-
scheduling.surgery-analysis-pool.core-pool-size=3
scheduling.surgery-analysis-pool.max-pool-size=5
scheduling.surgery-analysis-pool.queue-capacity=50
scheduling.surgery-analysis-pool.thread-name-prefix=medai-surgery-

# ===============================
# AI模型配置
# ===============================
# 注意：ai.model.stream 是自定义属性
ai.models.deepseek-chat.url=https://api.deepseek.com/chat/completions
ai.models.deepseek-chat.key=${DEEPSEEK_API_KEY}
ai.models.deepseek-chat.connectTimeout=60000
ai.models.deepseek-chat.readTimeout=600000
ai.models.deepseek-reasoner.url=https://api.deepseek.com/chat/completions
ai.models.deepseek-reasoner.key=${DEEPSEEK_API_KEY}
ai.models.deepseek-reasoner.connectTimeout=60000
ai.models.deepseek-reasoner.readTimeout=600000
# 注意：ai.request.* 是自定义属性

# ===============================
# 回调配置
# ===============================
callback.max-retries=5
callback.retry-interval=5000
callback.timeout=30000
callback.enabled=true
callback.default-callback-url=http://localhost:8081/api/callback/receive

# ===============================
# 安全配置
# ===============================
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${JWK_SET_URI}
spring.security.oauth2.resourceserver.jwt.issuer-uri=${ISSUER_URI}
