spring.application.name=med_ai_assistant_backend
server.port=8081

# 数据库类型配置: mysql 或 oracle (默认mysql)
# 注意：使用自定义属性，避免与Spring Boot的自动配置冲突
app.datasource.type=oracle

# 完全禁用数据初始化，避免Oracle数据类型不匹配导致的启动失败
spring.jpa.defer-datasource-initialization=true
spring.sql.init.mode=never

# MySQL 数据库配置 - 已清理，仅保留Oracle配置

# Oracle服务器配置 - 支持手动选择：本地local，内网internal
# 默认使用本地服务器
oracle.server.active=local

# 本地Oracle服务器配置
oracle.server.local.ip=127.0.0.1
oracle.server.local.sid=FREE
oracle.server.local.username=system
oracle.server.local.password=Liuzh_123

# 内网Oracle服务器配置
oracle.server.internal.ip=10.120.11.18
oracle.server.internal.sid=orcl
oracle.server.internal.username=medai
oracle.server.internal.password=medai

# Oracle 数据库配置 - 动态配置
spring.datasource.url=jdbc:oracle:thin:@${oracle.server.${oracle.server.active}.ip}:1521/${oracle.server.${oracle.server.active}.sid}
spring.datasource.driver-class-name=oracle.jdbc.OracleDriver
spring.datasource.username=${oracle.server.${oracle.server.active}.username}
spring.datasource.password=${oracle.server.${oracle.server.active}.password}

# Oracle连接池配置 - 避免启动时连接失败
spring.datasource.oracle.hikari.connection-timeout=30000
spring.datasource.oracle.hikari.initialization-fail-timeout=0

# HikariCP连接池优化配置 - 解决网络连接中断问题和资源竞争问题
# 优化说明：增加连接池大小以应对高并发场景，减少连接超时时间提高响应速度
spring.datasource.hikari.maximum-pool-size=15
spring.datasource.hikari.minimum-idle=3
spring.datasource.hikari.connection-timeout=10000
spring.datasource.hikari.idle-timeout=240000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.keepalive-time=120000
spring.datasource.hikari.validation-timeout=5000
spring.datasource.hikari.leak-detection-threshold=30000
spring.datasource.hikari.initialization-fail-timeout=0
spring.datasource.hikari.connection-test-query=SELECT 1 FROM DUAL
spring.datasource.hikari.connection-init-sql=ALTER SESSION SET NLS_DATE_FORMAT='YYYY-MM-DD HH24:MI:SS'
# 网络连接优化 - 针对网络中断问题
spring.datasource.hikari.data-source-properties.oracle.jdbc.ReadTimeout=60000
spring.datasource.hikari.data-source-properties.oracle.net.CONNECT_TIMEOUT=30000
spring.datasource.hikari.data-source-properties.oracle.net.READ_TIMEOUT=60000
spring.datasource.hikari.data-source-properties.oracle.jdbc.useThreadLocalBufferCache=true
spring.datasource.hikari.data-source-properties.oracle.net.ENABLE_EARLY_NOTIFICATION=true

# Disable H2 Console
spring.h2.console.enabled=false

# JPA/Hibernate Properties - 彻底禁用DDL自动管理，避免Oracle验证错误
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.hibernate.ddl-auto=none
# 禁用Schema管理工具，避免ORA-01439错误
spring.jpa.properties.hibernate.hbm2ddl.auto=none
spring.jpa.properties.hibernate.hbm2ddl.create_drop_schemas=false
spring.jpa.properties.hibernate.hbm2ddl.import_files_sql_extractor=
spring.jpa.properties.hibernate.hbm2ddl.connection.isolation=0
spring.jpa.properties.hibernate.hbm2ddl.halt_on_error=false
# 禁用自动验证，避免列类型验证导致的约束冲突
spring.jpa.properties.hibernate.hbm2ddl.validate_on_update=false
# spring.jpa.database-platform=org.hibernate.dialect.OracleDialect - Hibernate 6.x已能自动检测Oracle方言
spring.jpa.properties.hibernate.globally_quoted_identifiers=false
spring.jpa.properties.hibernate.jdbc.time_zone=Asia/Shanghai
# 配置物理命名策略，确保表名和列名正确映射
spring.jpa.properties.hibernate.physical_naming_strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl

# Hibernate SQL日志级别配置 - 禁用SQL语句输出
logging.level.org.hibernate.SQL=OFF
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=OFF

# 医院配置服务日志级别
logging.level.com.example.medaiassistant.hospital.service.HospitalConfigService=DEBUG

# 显式导入AI模型配置
spring.config.import=classpath:ai-models.properties,file:./config/application-patient-status-filter.properties

# 允许bean定义覆盖
spring.main.allow-bean-definition-overriding=true

# API服务配置 - 可外部化配置，支持不同环境
api.base.url=http://localhost:8081

# 异步回调配置
callback.max-retries=3
callback.retry-interval=5000
callback.timeout=30000
callback.enabled=false
callback.default-callback-url=http://localhost:8081/api/callback/receive

# 执行服务器配置 - 统一配置管理
# 统一配置键名（新配置，推荐使用）
execution.server.host=nb.nblink.cc
execution.server.oracle-port=16601
execution.server.oracle-sid=FREE
execution.server.api-url=http://excutehttpservice.iepose.cn/api

# 向后兼容配置（旧配置，保持兼容）
execution.server.ip=100.66.1.2
execution.server.url=http://${execution.server.ip}:8082

# 执行服务器数据库配置
spring.datasource.sid=FREE

# 自动执行配置
# 统一调度配置
scheduling.auto-execute.interval=5000
scheduling.auto-execute.max-threads=10
scheduling.auto-execute.enabled=true

scheduling.timer.daily-time=0 0 4 * * *
scheduling.timer.surgery-analysis-time=0 0 5 * * *
scheduling.timer.noon-ward-round-time=0 0 13 * * *
scheduling.timer.max-concurrency=5
scheduling.timer.fixed-delay-minutes=5



# Prompt生成专用线程池配置（优化以提高并发处理能力）
scheduling.prompt-generation-pool.core-pool-size=5
scheduling.prompt-generation-pool.max-pool-size=8
scheduling.prompt-generation-pool.queue-capacity=100
scheduling.prompt-generation-pool.thread-name-prefix=medai-prompt-

# 手术分析专用线程池配置（优化以提高并发处理能力）
scheduling.surgery-analysis-pool.core-pool-size=5
scheduling.surgery-analysis-pool.max-pool-size=8
scheduling.surgery-analysis-pool.queue-capacity=100
scheduling.surgery-analysis-pool.thread-name-prefix=medai-surgery-

scheduling.executor.pool-size=5
scheduling.executor.thread-name-prefix=medai-scheduler-
scheduling.executor.core-pool-size=10
scheduling.executor.max-pool-size=20
scheduling.executor.queue-capacity=200

scheduling.monitoring.enabled=true
scheduling.monitoring.metrics-interval=60000
scheduling.monitoring.alert-emails=admin@example.com

# 提交服务独立配置 - 更频繁的提交
prompt.submission.enabled=true
prompt.submission.interval=8000
prompt.submission.page-size=5
prompt.submission.max-threads=3
prompt.submission.max-retries=3
prompt.submission.retry-interval=1000

# 轮询服务独立配置 - 较慢的轮询  
prompt.polling.enabled=true
prompt.polling.interval=15000
prompt.polling.page-size=10
prompt.polling.max-retries=5
prompt.polling.retry-interval=2000
prompt.polling.batch-size=20

# 兼容旧配置（用于PollingService类的@Scheduled注解）
polling.interval=15000

# API调用超时配置 - 迭代1 MVP优化
api.base.timeout.connect=10000
api.base.timeout.read=30000
api.base.retry.max-attempts=2

# 连接池配置
http.client.pool.max-total=200
http.client.pool.max-per-route=50
http.client.pool.request-timeout=30000
http.client.pool.connect-timeout=30000
http.client.pool.socket-timeout=300000
http.client.pool.connection-keep-alive=true
http.client.pool.keep-alive-time=30000

# 限流配置
rate.limit.max-concurrent-requests=10
rate.limit.queue-capacity=100
rate.limit.timeout-ms=300000
rate.limit.enabled=true

# 重试策略配置
retry.policy.max-retries=3
retry.policy.initial-interval-ms=1000
retry.policy.multiplier=2.0
retry.policy.max-interval-ms=30000
retry.policy.retryable-status-codes=429,500,502,503,504

# DRG定时任务配置
drg.daily-task.cron=0 0 2 * * ?
drg.daily-task.batch-size=100
drg.daily-task.max-retries=3
drg.daily-task.timeout-minutes=60
drg.daily-task.enabled=true

# 监控和可观测性配置
# 系统健康监控阈值
monitoring.system.disk.threshold=90.0
monitoring.system.thread.threshold=500
monitoring.system.response-time.threshold=5000

# 业务指标监控阈值 - 调整启动阶段阈值避免误报
monitoring.business.min-throughput=0
monitoring.business.max-response-time=30000
monitoring.business.min-success-rate=0
monitoring.business.min-availability=99.0
monitoring.alerts.suppression-minutes=5

# 告警配置
monitoring.alerts.enabled=true
monitoring.alerts.suppression-minutes=10
monitoring.alerts.max-active-alerts=100
monitoring.alerts.email.enabled=false
monitoring.alerts.email.recipients=admin@example.com

# 指标收集配置
monitoring.metrics.enabled=true
monitoring.metrics.snapshot.interval=300000
monitoring.metrics.retention.days=7
monitoring.metrics.collection.jvm=true
monitoring.metrics.collection.business=true

# 字符编码配置 - 解决中文乱码问题
spring.http.encoding.charset=UTF-8
spring.http.encoding.enabled=true
spring.http.encoding.force=true
server.servlet.encoding.charset=UTF-8
server.servlet.encoding.enabled=true
server.servlet.encoding.force=true

# 医院配置目录
hospital.config.dir=config/hospitals

# 默认医院ID（用于开发环境）
hospital.default.id=hospital-Local

# 夜间同步任务配置
# 是否启用夜间同步
nightly.sync.enabled=true
# 是否在系统启动时自动执行同步（默认false）
nightly.sync.on-startup=true
# 定时执行Cron表达式（默认凌晨1点）
nightly.sync.cron=0 0 1 * * ?

# Spring Boot DevTools Configuration
spring.devtools.restart.enabled=true
spring.devtools.livereload.enabled=true
spring.devtools.restart.poll-interval=1000
spring.devtools.restart.quiet-period=400

# 实时语音识别配置 (阿里云百炼ASR)
voice.recognition.api-key=sk-e4eaeab6457448bcac6668a3b7c3e97d
voice.recognition.model=paraformer-realtime-v2
voice.recognition.sample-rate=16000
voice.recognition.format=pcm
